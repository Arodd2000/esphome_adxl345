i2c:
  id: display_i2c
  sda: GPIO25
  scl: GPIO22
  scan: false
  frequency: 800kHz

font:
  - file: 'dogicapixel.ttf'
    id: ttf8
    size: 8
  - file: 'dogicapixel.ttf'
    id: ttf12
    size: 12
  - file: 'dogicapixel.ttf'
    id: ttf24
    size: 24

image:
  - file: 'icons/thermometer-alert-whitebg.png'
    id: icon_thermometer_alert
  - file: 'icons/thermometer-chevron-up-whitebg.png'
    id: icon_thermometer_heating
  - file: 'icons/thermometer-high-whitebg.png'
    id: icon_thermometer_high

  - file: 'icons/battery-alert-variant-outline-whitebg.png'
    id: icon_battery_alert

display:
  - platform: ssd1306_i2c
    id: main_display
    i2c_id: display_i2c
    model: "SH1106 128x64"
    update_interval: 500ms
    pages:
      - id: kettle_disconnected
        lambda: |-
          it.print(63, 16, id(ttf12), TextAlign::TOP_CENTER, "Kettle not");
          it.print(63, 50, id(ttf12), TextAlign::BOTTOM_CENTER, "connected!");

      - id: main_page
        lambda: |-
          if (id(water_temperature).has_state() && !isnan(id(water_temperature).state))
            it.printf(2, 14, id(ttf24), TextAlign::TOP_LEFT, "%.0f", id(water_temperature).state);
          else
            it.print(18, 14, id(ttf12), TextAlign::TOP_LEFT, "-");

          it.print(42, 14, id(ttf12), TextAlign::TOP_LEFT, "°C");

          it.printf(64, 23, id(ttf12), TextAlign::TOP_LEFT, "%.0f", id(temperature_pid).target_temperature);
          it.print(86, 23, id(ttf8), TextAlign::TOP_LEFT, "°C");

          it.print(126, 12, id(ttf8), TextAlign::TOP_RIGHT, id(profile).state.c_str());

          it.print(2, 52, id(ttf8), TextAlign::BOTTOM_LEFT, "00:00");


          bool pid_active = id(temperature_pid).mode != CLIMATE_MODE_OFF;
          bool heating_element_active = id(heating_element_feedback).state;

          if (heating_element_active) {
            it.image(102, 28, id(icon_thermometer_heating));

          } else if (id(temperature_reached).state) {
            it.image(102, 28, id(icon_thermometer_alert));

          } else if (pid_active && !heating_element_active) {
            it.image(102, 28, id(icon_thermometer_high));

          }

          if (id(ble_battery_level).state < 30.0)
            if ((millis() / 500) % 3)
              it.image(102, 28, id(icon_battery_alert));

      - id: display_off
        lambda: ''

